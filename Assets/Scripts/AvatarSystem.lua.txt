unity=CS.UnityEngine
function init()
	initSource()
	loadSkinnedInfo(sourceTransform,skinnedSources,target,targetMesh)
	initCharacter(targetDatas)
end
function split(input, delimiter)
	input = tostring(input)
	delimiter = tostring(delimiter)
	if (delimiter == "") then return false end
	local pos, arr = 0, {}
	for st, sp in function() return string.find(input, delimiter, pos, true) end do
		table.insert(arr, string.sub(input, pos, st - 1))
		pos = sp + 1
	end
	table.insert(arr, string.sub(input, pos))
	return arr
end
function initSource()
	avatarSystem=unity.GameObject.Find("AvatarSystem"):GetComponent("AvatarSystem")
	avatarSystem.ab=avatarSystem:LoadAssetBundle("target.u3d")
	local temp=avatarSystem:loadSourcesFromAssetBundle("FemaleModel Variant")
	sourcesGameObject=avatarSystem:TypeChange(unity.Object.Instantiate(temp))
	skinnedSources=avatarSystem.skinnedSources
	temp=avatarSystem:loadSourcesFromAssetBundle("target")
	target=avatarSystem:TypeChange(unity.Object.Instantiate(temp))
	avatarSystem.target=target
	avatarSystem.targetHips=avatarSystem:getBonesFromObj(target)
	targetMesh=avatarSystem.targetMesh
	targetDatas=avatarSystem.targetDatas
	sourceTransform=sourcesGameObject:GetComponent("Transform")
	avatarSystem.sourceTransform=sourceTransform
	sourcesGameObject:SetActive(false)
	
end

function loadSkinnedInfo(sourceTran,datas,targetS,smr)
	if sourceTran==nil then
		return
	end
	datas:Clear()
	smr:Clear()
	local sm=sourceTran:GetComponentsInChildren(typeof(unity.SkinnedMeshRenderer))
	for i=0,sm.Length-1,1 do
		local v=sm[i]
		names=split(v.name,'-')
		if(datas:ContainsKey(names[1])==false) then
			local partGo=unity.GameObject()
			partGo.name=names[1]
			partGo.transform.parent=target.transform
			smr:Add(names[1],partGo:AddComponent(typeof(unity.SkinnedMeshRenderer)))
			datas:Add(names[1],avatarSystem:getDict())
		end
		datas:get_Item(names[1]):Add(names[2],v)
	end
end

function initCharacter(targetStr)
	local len=(targetStr:GetLength(0))
	for i = 0, len-1 do
		avatarSystem:OnChangePeople(targetStr:GetValue(i,0),targetStr:GetValue(i,1))
	end
end



init()